"use strict";var $=jQuery.noConflict();function buildDevelopers(){$.isEmptyObject(config.package)||config.built.developer||($("#code-javascript").text('$.ajax({\n    dataType: "json",\n    type: "GET",\n    url: "'+config.ckanAPI+'package_search",\n    data: { "q": \'title:"'+config.package.title+"\"' }\n}).done(function(response) {\n    console.log(response);\n});"),$("#code-python").text('import requests\nimport json\n\nurl = "'+config.ckanAPI+'package_search"\nresponse = requests.get(url, data={ "q": "title:\''+config.package.title+"'\" })\nresults = json.loads(response.content)\nprint(results)"),config.built.developer=!0)}function buildDownloads(){if(!$.isEmptyObject(config.package)&&!config.built.downloads){for(var e in config.package.resources)if("Preview data"!=config.package.resources[e].file_type){var a=config.package.resources[e],t=config.ckanURL+"/download_resource/"+a.id;a.datastore_active&&(a.format='<select class="select-download-formats">'+("CSV"==a.format.toUpperCase()?'<option value="csv">CSV</option>':"")+'<option value="json">JSON</option><option value="xml">XML</option></select>'),$("#table-resources tbody").append('<tr data-stored="'+a.datastore_active+'"><td>'+a.format+"</td><td>"+a.name+'</td><td><a href="'+t+'">Download <span class="sr-only">'+a.name+"</span></a></td></tr>")}$("#table-resources tbody a").on("click",function(e){e.preventDefault();var a=$(this).attr("href");$(this).parents("tr").data("stored")&&(a+="?format="+$(this).parents().eq(1).find("select").val()),window.open(a,"_blank")}),config.built.downloads=!0}}function buildExplore(){if(!$.isEmptyObject(config.package)&&!config.built.explore)switch(config.package.dataset_category){case"Table":$("#explore-esri").hide(),getCKAN("resource_view_list",{id:config.package.primary_resource.id},function(e){for(var a=e.result,t="#",i=0;i<a.length;i++){var r=a[i];if("recline_view"==r.view_type){t=config.ckanURL+"/dataset/"+config.package.name+"/resource/"+r.resource_id+"/view/"+r.id;break}}$("#redirect-ckan").attr("href",t),config.built.explore=!0});break;case"Map":$("#explore-ckan").hide(),$("#redirect-esri").attr("href",config.package.explore_url),config.built.explore=!0}}function buildFeatures(){$.isEmptyObject(config.package)||config.built.features||getCKAN("datastore_search",{resource_id:config.package.primary_resource.id},function(e){for(var a=e.result.fields,t="",i=0;i<a.length;i++)t+="<tr><td>"+a[i].id+"</td><td>"+a[i].type+"</td><td></td></tr>";$("#table-features tbody").append(t),config.built.features=!0})}function buildPreview(e){if(!$.isEmptyObject(config.package)&&!config.built.preview)switch(config.package.dataset_category){case"Table":getCKAN("datastore_search",{resource_id:config.package.primary_resource.id,limit:3},function(e){for(var a=e.result.records,t=e.result.fields,i="<thead>",r="<tbody>",o=0;o<a.length;o++){for(var s in r+="<tr>",t)0==o&&(i+="<th>"+t[s].id+"</th>"),r+="<td>"+a[o][t[s].id]+"</td>";r+="</tr>"}i+="</thead>",r+="</tbody>",$("#content-preview").append('<table class="table table-striped table-responsive">'+i+r+"</table>"),config.built.preview=!0});break;case"Map":var a=$.isEmptyObject(config.package.preview_resource)?config.package.primary_resource:config.package.preview_resource;getCKAN("resource_view_list",{id:a.id},function(e){for(var a=e.result,t=0;t<a.length;t++){var i=a[t];if("geojson_view"==i.view_type){var r=config.ckanURL+"/dataset/"+config.package.name+"/resource/"+i.resource_id+"/view/"+i.id,o=$("#collapse-preview .col-md-12").width(),s=o/2;$("#content-preview").append('<iframe width="'+o+'" height="'+s+'" src="'+r+'" frameBorder="0"></iframe>'),config.built.preview=!0;break}}})}}function buildUI(){$("#heading-developers").on("click",buildDevelopers),$("#heading-download").on("click",buildDownloads),$("#heading-explore").on("click",buildExplore),$("#heading-features").on("click",buildFeatures),$("#heading-preview").on("click",buildPreview),config.isInitializing=!1,$(".block-hidden").fadeIn(250),$(".card-header:visible:first a").click()}function buildDataset(e){var o=config.package=e.result;for(var a in o.primary_resource={},o.preview_resource={},o.resources)if(0<o.resources[a].file_type.length)switch(o.resources[a].file_type){case"Primary data":o.primary_resource=o.resources[a];break;case"Preview data":o.preview_resource=o.resources[a]}$("[data-field]").each(function(e){var a=$(this).data("field");if(o.image_url=o.image_url||"https://images.pexels.com/photos/374870/pexels-photo-374870.jpeg?auto=compress&cs=tinysrgb&dpr=2&h=650&w=940",o[a])switch(a){case"image_url":$(this).css("background-image",'url("'+o[a]+'")');break;case"information_url":$(this).append('<a href="'+o[a]+'">External Link</a>');break;case"tags":for(var t=0;t<o[a].length;t++)$(this).is(":empty")||$(this).append(", "),$(this).append('<a href="/catalogue?q=(vocab_tags:&quot;'+o[a][t].display_name+'&quot;)">'+o[a][t].display_name+"</a>");break;case"metadata_modified":var i=o.primary_resource.last_modified||o[a];$(this).text(getFullDate(i.substring(0,10).split("-")));break;case"published_date":$(this).text(getFullDate(o[a].substring(0,10).split("-")));break;case"notes":var r=new showdown.Converter;$(this).html(r.makeHtml(o[a]));break;default:$(this).text(o[a])}else $(this).prev().hide()}),-1==["Map","Table"].indexOf(o.dataset_category)||"true"==o.is_archive||"false"==o.is_visualizable?$("#heading-preview, #heading-features, #heading-explore").hide():"Map"==o.dataset_category&&$("#heading-features").hide(),buildUI()}function init(e){$(".block-hidden").hide(),getCKAN("package_show",{id:e},buildDataset)}$.extend(config,{isInitializing:!0,package:{},built:{}});